# ZM Dating Bot

Telegram-бот для корпоративных знакомств и тимбилдинга.
Каждую неделю бот случайно сопоставляет пары сотрудников одной компании,
чтобы они могли познакомиться и пообщаться.

---

## Возможности

- FSM-анкета: собирает локацию, отдел, должность, увлечения и фото
- Редактирование профиля в любое время
- Автоматическое сопоставление пар по понедельникам в 17:00 (МСК)
- Опросы по четвергам в 17:00 (МСК)
- Вторичные опросы пятницам в 17:00 (МСК)
- Возможность отключить участие с удержанием
- Полная контейнеризация через Docker
- SQLite с хранением в volume
- Экспорт статистики в .xlsx формате

---

## Стек технологий

- Python 3.x
- [Aiogram 3](https://docs.aiogram.dev/)
- SQLite + SQLAlchemy (async)
- APScheduler (cron-планировщик)
- openpyxl (экспорт статистики в .xlsx)
- Docker + docker-compose

---

## Установка

### 1. Клонируй репозиторий

```
bash

git clone https://github.com/your-org/zm-dating-bot.git && cd zm-dating-bot
```

### 2. Создай .env на основе шаблона

```
bash

cp .env.example .env
```

### 3. Заполни переменные:

```
.env

BOT_TOKEN=токен_вашего_бота
# Нужно оставить таким - зависимость от драйвера
DATABASE_URL=sqlite+aiosqlite:///data/db.sqlite3
# test | prod
ENV=переменная_среды
# Требует !минимум! 2 значения через запятую (можно одинаковые) - идентификатор телеграм
ADMINS=123456789,987654321
```

### 4. Запусти бота через Docker

```
bash

docker-compose up --build
```

Бот автоматически начнёт работу и будет выполнять:

* Сопоставление пар: каждый понедельник в 17:00
* Первичный опрос: каждый четверг в 17:00
* Вторичный опрос: каждый четверг в 17:00

---

## Структура проекта

```
zm_dating_bot/
│
├── bot/
│   ├── handlers/            # FSM, меню, отключение и прочее
│   ├── scheduler/           # Планировщик, мэтчинг, опросы
│   └── main.py              # Точка входа
│
├── alembic.ini
├── migrations/
│   ├── env.py
│   ├── versions/
│   ├── README
│   └── script.py.mako
│
├── db/
│   ├── models.py            # SQLAlchemy модели
│   ├── crud.py              # CRUD-методы
│   └── session.py           # Подключение к БД
│
├── .env.example             # Шаблон переменных окружения
├── Dockerfile
├── docker-compose.yml
├── entrypoint.sh
├── requirements.txt
└── README.md

```

---

## База данных

Используется SQLite.

Файл БД сохраняется внутри Docker volume sqlite_data по пути ```/app/data/db.sqlite3```.

---

## Планировщик

Планировщик основан на APScheduler и автоматически активирует:

| Задача  | Время (МСК) | Описание                          |
|---------|-------------|-----------------------------------|
| Мэтчинг | Пн 17:00    | Сопоставление пар участников      |
| Опрос   | Чт 17:00    | Спрашиваем, как прошло знакомство |
| Опрос 2 | Пт 17:00    | Уточняем, удалось ли пообщаться   |

---

## Сбор статистики

Сбор статистики доступен только указанным пользователям,
и осуществляется следующей командой:

```
bot_command

/analyze dd-mm-yyyy - dd-mm-yyy
```